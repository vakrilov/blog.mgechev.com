    <!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<meta name="description" content="The official blog of Minko Gechev">
		<meta name="generator" content="Hugo 0.22-DEV" />
		<title>Caching CSS with localStorage &middot; Minko Gechev&#39;s blog</title>
		<link rel="shortcut icon" href="http://blog.mgechev.com/images/favicon.ico">
		<link rel="stylesheet" href="http://blog.mgechev.com/css/style.css">
		<link rel="stylesheet" href="http://blog.mgechev.com/css/highlight.css">
		<link rel="stylesheet" href="http://blog.mgechev.com/css/firacode/fira.css">
		

		
		<link rel="stylesheet" href="http://blog.mgechev.com/css/font-awesome.min.css">
		

		
		<link href="http://blog.mgechev.com/index.xml" rel="alternate" type="application/rss+xml" title="Minko Gechev&#39;s blog" />
		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='http://blog.mgechev.com/'> <span class="arrow">←</span>Home</a>
	
	<a href='http://blog.mgechev.com/about'>About</a>
	<a href='http://blog.mgechev.com/talks'>Talks</a>
	<a href='http://blog.mgechev.com/post'>Archive</a>

	

	
	<a class="cta" href="http://blog.mgechev.com/index.xml">Subscribe</a>
	
</nav>


        <section id="wrapper">
            <article class="post">
                <header>
                    <h1>
                        Caching CSS with localStorage
                    </h1>
                    <h2 class="headline">
                    <a href="https://github.com/mgechev/blog.mgechev.com/tree/master/content/post/post/2012-09-04-caching-css-in-the-localstorage.md">
                        <i class="fa fa-pencil-square-o"></i> Edit
                    </a>
                    · Sep 4, 2012 00:00
                    · 716 words
                    · 4 minutes read
                      <span class="tags">
                      
                      
                          
                              <a href="http://blog.mgechev.com/tags/HTML5">HTML5</a>
                          
                              <a href="http://blog.mgechev.com/tags/HTTP">HTTP</a>
                          
                              <a href="http://blog.mgechev.com/tags/JavaScript">JavaScript</a>
                          
                              <a href="http://blog.mgechev.com/tags/localStorage">localStorage</a>
                          
                              <a href="http://blog.mgechev.com/tags/performance">performance</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                <section id="post-body">
                    <p>Since HTML5 became wide supported the most popular aspects I hear about were it&#8217;s canvas, WebSockets and localStorage. I&#8217;ve got very close experience with the first two of the mentioned but the localStorage was somehow unknown for me since a month. I&#8217;ve researched the topic. Actually it&#8217;s quite interesting and useful as you might guess. Using localStorage you can save different kinds of data locally into key-value pairs. The data lives on your local machine until it&#8217;s deleted (cleared). The localStorage allows you to use more storage than cookies and have no expiration interval (the expiration completely depends on the user). As you might guess again the data stored into the localStorage is saved on the hard drive. May be you know that it&#8217;s very expensive to take data from the hard drive because of the mechanical movements required for buffering the data. The localStorage size depends on the implementation. In Chrome, Firefox, Opera and Safari you can use 5 MBs. Actually it&#8217;s enough for caching all the CSS and JavaScript of your webpage (I really hope so).</p>

<p>Here comes the topic about the inline and referential CSS. As you know the inline CSS prevents you from many HTTP requests to the server but also prevents from caching. Which is the &#8220;bigger evil&#8221;? It depends on how big is your website, CSS and JavaScript. For bigger websites it&#8217;s not recommended to inline your CSS because you throw away the browser&#8217;s caching which very often is your biggest friend (when you&#8217;re looking for performance).</p>

<p>But what happens when the browser cache is empty, all your content isn&#8217;t cached and everything should be downloaded again? Well definitely an impact on the performance. How can be prevented? As you will see the localStorage is a sample solution. Of course you&#8217;ve got to be careful with the impact of the slower hard drives (slower than the memory) so you have to take as much data as possible with a single localStorage.getItem &#8220;request&#8221;. Browser&#8217;s cache is cleverer than our use of the localStorage but anyway. But how much can this feature of HTML5 can improve our performance? The line chart below is shows the time required for downloading all resources from an empty page with just six CSS files included.</p>

<p>The test is made using Google Chrome Version 20.0.1132.57.</p>

<div id="attachment_174" style="width: 725px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/09/loading.png"><img class="size-full wp-image-174 " title="Downloading required data" src="/images/legacy/uploads2012/09/loading.png" alt="" width="715" height="320" /></a><p class="wp-caption-text">
    With the blue line is the variant using localStorage. The red line is using referential CSS (not inline).
  </p>
</div>

<p>For the localStorage caching I&#8217;ve wrote a simple script that checks whether the mentioned file is already into the localStorage, if it is it&#8217;s content is put inside a style element and added into the DOM tree (actually all CSS files are added into one step because of improving the performance). If the file is not into the localStorage, using XMLHttp request, it&#8217;s content is loaded and cached. The thing that isn&#8217;t considered here: multiple localStorage.getItem calls which are not preferable because of the hard drive latency.</p>

<p>As you see the difference is big enough. The average time required to load the page using localStorage cache is 4.47 ms versus 14 ms required for loading the page without localStorage cache.</p>

<p>The most critical stage for our local storage caching is when the page is loaded for first time. There&#8217;s a big overhead because of the XMLHttp requests which get the CSS.</p>

<p>This is just the half of the most exiting part. The impact on the time required for onload event to be fired is shown on the chart below.</p>

<p>The X-axis is the test ID and the Y-axis is the time required in ms. As you see here the browser&#8217;s caching wins. The average score for the localStorage is 42.19 versus 29.81.</p>

<div id="attachment_175" style="width: 725px" class="wp-caption alignnone">
  <a href="/images/legacy/uploads2012/09/onload2.png"><img class="size-full wp-image-175 " title="Time required for onload event to be fired. X axis is the test ID and the Y axis time in ms. " src="/images/legacy/uploads2012/09/onload2.png" alt="" width="715" height="320" /></a><p class="wp-caption-text">
    Time required for onload event to be fired. X axis is the test ID and the Y axis time in ms.
  </p>
</div>

<p>As conclusion I can said that it&#8217;s a matter of choice and need which approach will be chosen. If use a lot of CSS files may be reducing the HTTP requests will be preferable but also collecting all the files as different key value pairs into the localStorage, like in the example above, is not very recommended because of the hard drive latency. In any case your choice should be well considered and tested because the performance impact may be critical.</p>

                </section>
            </article>

            

            
                <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mgechev';

     
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            

            

            <footer id="footer">
    <div class="by-author">with <i class="fa fa-heart" aria-hidden="true"></i> by Minko Gechev</div>
    <p class="small">
         © Copyright 2017  
    </p>
</footer>
        </section>

        <script src="http://blog.mgechev.com/js/main.js"></script>




  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-18060688-3', 'auto');
ga('send', 'pageview');
</script>





    </body>
</html>
