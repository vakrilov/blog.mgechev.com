    <!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<meta name="description" content="The official blog of Minko Gechev">
		<meta name="generator" content="Hugo 0.22-DEV" />
		<title>Singleton in JavaScript &middot; Minko Gechev&#39;s blog</title>
		<link rel="shortcut icon" href="http://blog.mgechev.com/images/favicon.ico">
		<link rel="stylesheet" href="http://blog.mgechev.com/css/style.css">
		<link rel="stylesheet" href="http://blog.mgechev.com/css/highlight.css">
		<link rel="stylesheet" href="http://blog.mgechev.com/css/firacode/fira.css">
		

		
		<link rel="stylesheet" href="http://blog.mgechev.com/css/font-awesome.min.css">
		

		
		<link href="http://blog.mgechev.com/index.xml" rel="alternate" type="application/rss+xml" title="Minko Gechev&#39;s blog" />
		
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='http://blog.mgechev.com/'> <span class="arrow">←</span>Home</a>
	
	<a href='http://blog.mgechev.com/about'>About</a>
	<a href='http://blog.mgechev.com/talks'>Talks</a>
	<a href='http://blog.mgechev.com/post'>Archive</a>

	

	
	<a class="cta" href="http://blog.mgechev.com/index.xml">Subscribe</a>
	
</nav>


        <section id="wrapper">
            <article class="post">
                <header>
                    <h1>
                        Singleton in JavaScript
                    </h1>
                    <h2 class="headline">
                    <a href="https://github.com/mgechev/blog.mgechev.com/tree/master/content/post/2014-04-16-singleton-in-javascript.md">
                        <i class="fa fa-pencil-square-o"></i> Edit
                    </a>
                    · Apr 16, 2014 00:00
                    · 929 words
                    · 5 minutes read
                      <span class="tags">
                      
                      
                          
                              <a href="http://blog.mgechev.com/tags/Design-patterns">Design patterns</a>
                          
                              <a href="http://blog.mgechev.com/tags/JavaScript">JavaScript</a>
                          
                              <a href="http://blog.mgechev.com/tags/Singleton">Singleton</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                <section id="post-body">
                    <p>Wikipedia describes the singleton design pattern as:</p>

<blockquote>
<p>The singleton pattern is a design pattern that restricts the instantiation of a class to one object. This is useful when exactly one object is needed to coordinate actions across the system. The concept is sometimes generalized to systems that operate more efficiently when only one object exists, or that restrict the instantiation to a certain number of objects. The term comes from the mathematical concept of a singleton.</p>
</blockquote>

<div id="attachment_708" style="width: 231px" class="wp-caption aligncenter">
  <a href="/images/legacy/uploads2014/04/singleton.png"><img src="/images/legacy/uploads2014/04/singleton-221x300.png" alt="Singleton" width="221" height="300" class="size-medium wp-image-708" /></a><p class="wp-caption-text">
    Singleton
  </p>
</div>

<p>Singleton is one of the most well known and also hated design patterns, all the time. It is very easy to implement a basic version of the singleton pattern so that&#8217;s the reason it is that well known. But if we look deeper into different details, there are plenty of problems, which may happen because of poor implementation:</p>

<ul>
<li>Instantiating multiple singletons because of concurrent access to the <code>getInstance</code> method of the singleton.</li>
<li>Instantiating multiple singletons because of serialization/deserialization</li>
<li>Inheriting from a singleton object</li>
<li>etc&#8230;</li>
</ul>

<p>Thanks God we don&#8217;t have to consider all these corner cases in JavaScript.</p>

<p>The simplest singleton implementation in JavaScript is:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">var</span> <span class="nx">Singleton</span> <span class="o">=</span> <span class="p">{};</span>
</code></pre></div>


<p>And yes &#8211; this is singleton!</p>

<p>Addy Osmani suggests the following implementation at his book <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#singletonpatternjavascript">&#8220;Learning JavaScript Design Patterns&#8221;</a>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">var</span> <span class="nx">mySingleton</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Instance stores a reference to the Singleton</span>
  <span class="kd">var</span> <span class="nx">instance</span><span class="p">;</span>
  <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Singleton</span>
    <span class="c1">// Private methods and variables</span>
    <span class="kd">function</span> <span class="nx">privateMethod</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;I am private&quot;</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">privateVariable</span> <span class="o">=</span> <span class="s2">&quot;Im also private&quot;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">privateRandomNumber</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">();</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="c1">// Public methods and variables</span>
      <span class="nx">publicMethod</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;The public can see me!&quot;</span> <span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">publicProperty</span><span class="o">:</span> <span class="s2">&quot;I am also public&quot;</span><span class="p">,</span>
      <span class="nx">getRandomNumber</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">privateRandomNumber</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="c1">// Get the Singleton instance if one exists</span>
    <span class="c1">// or create one if it doesn&#39;t</span>
    <span class="nx">getInstance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nx">instance</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">instance</span> <span class="o">=</span> <span class="nx">init</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">instance</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">})();</span>
</code></pre></div>


<p>This implementation is based on the module pattern. The module pattern is applied two times &#8211; the first application aims to provide the actual singleton and keeps the private data/behavior inside a closure. The second usage of the module pattern aims to provide the public interface used for getting the singleton object, which is kept inside a closure.</p>

<p>It is absolutely valid and useful implementation:</p>

<ul>
<li>It instantiates only a single object</li>
<li>It is safe &#8211; it keeps the reference to the singleton inside a variable, which lives inside a lexical closure, so it is not accessible by the outside world</li>
<li>It allows privacy &#8211; you can define all private methods of your singleton inside the lexical closure of the first module pattern</li>
</ul>

<p>As drawback I can point the lack of specific &#8220;type&#8221; of the singleton (i.e. more specific than object), which won&#8217;t allow you to use the operator <code>instanceof</code>. I can argue that the definition of the <code>private</code> members can lead to poor unit testing, but if they are private, they are not intended for testing anyway.</p>

<p>Another implementation of singleton, which I found in the network is <a href="http://stackoverflow.com/a/6733919/1106382">&#8220;The best Singleton pattern&#8221;</a>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">global</span><span class="p">)</span> <span class="p">{</span>
  <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">MySingletonClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nx">MySingletonClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_singletonInstance</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">MySingletonClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_singletonInstance</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">MySingletonClass</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_singletonInstance</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">Foo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">};</span>
  <span class="p">};</span>

<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySingletonClass</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">MySingletonClass</span><span class="p">();</span>
<span class="c1">//a === b</span>
<span class="nx">global</span><span class="p">.</span><span class="nx">MySingleton</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span> <span class="c1">//or b</span>

<span class="p">}(</span><span class="nb">window</span><span class="p">));</span>
</code></pre></div>


<p>Here are the main advantages of this implementation:</p>

<ul>
<li>It instantiates only a single object</li>
<li>You can use the <code>instanceof</code> operator</li>
</ul>

<p>As drawback I can state the fact that you can easy change the prototype property <code>_singletonInstance</code> of your singleton. This way, when <code>MySingleton</code> is called once again, it will create a new object:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nx">MySingleton</span><span class="p">).</span><span class="nx">_singletonInstance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</code></pre></div>


<p>Implementation I use is formed by combining both approaches from above:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span></span><span class="kd">var</span> <span class="nx">MySingleton</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">INSTANCE</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">MySingleton</span><span class="p">(</span><span class="nx">foo</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">MySingleton</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">MySingleton</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">MySingleton</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//do something;</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">INSTANCE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">INSTANCE</span> <span class="o">=</span> <span class="nx">MySingleton</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">INSTANCE</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="nx">getInstance</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">INSTANCE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">INSTANCE</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

<span class="p">}());</span>
</code></pre></div>


<p>In this example we use the module pattern once again, in order to enclose the singleton implementation into a lexical closure and provide a public interface for getting its instance.</p>

<p>Sometimes you need to pass arguments when initializing a singleton for first time. This is easy achieved using the method <code>init</code>. The <code>init</code> method is not aware of the arguments required by the singleton &#8211; all it does is to forward the call to the internal <code>MySingleton</code> function with context <code>null</code>. Inside the implementation of the <code>MySingleton</code> constructor function we make a check whether the current context &#8211; <code>this</code> is of type <code>MySingleton</code>, if it isn&#8217;t, then this means that <code>MySingleton</code> is not called with the <code>new</code> operator, so we recursively call <code>new MySingleton</code> with the required parameters.</p>

<p>What are the benefits we get from this implementation:</p>

<ul>
<li>It instantiates only a single object</li>
<li>It is safe &#8211; it keeps the reference to the singleton inside a variable, which lives inside a lexical closure and is not accessible by the outside world</li>
<li>It allows you to initialize the singleton with some arguments. The module pattern, which wraps the singleton is not aware of the initialization arguments &#8211; it simply forwards the call with <code>apply</code></li>
<li>You can use the <code>instanceof</code> operator</li>
</ul>

<p>As drawback, I can state that I feel unnatural for this implementation to use &#8220;private&#8221; data/behavior &#8211; but yes, it is possible if you define them in the lexical closure of the module pattern.</p>

                </section>
            </article>

            

            
                <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mgechev';

     
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            

            

            <footer id="footer">
    <div class="by-author">with <i class="fa fa-heart" aria-hidden="true"></i> by Minko Gechev</div>
    <p class="small">
         © Copyright 2017  
    </p>
</footer>
        </section>

        <script src="http://blog.mgechev.com/js/main.js"></script>




  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-18060688-3', 'auto');
ga('send', 'pageview');
</script>





    </body>
</html>
